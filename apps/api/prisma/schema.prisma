generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum UserRoleType {
  CUSTOMER
  SUPER_ADMIN
  WAREHOUSE_ADMIN
}

model Users {
  id              Int          @id @default(autoincrement())
  firstName       String
  lastName        String
  email           String
  password        String?
  profileImageUrl String?
  role            UserRoleType
  isDelete        Boolean
  token           String
  createdAt       DateTime     @default(now())
  updateAt        DateTime     @updatedAt

  address  Address[]
  order    Order[]
  cart     Cart[]
  employee Employee?

  @@map("users")
}

model Address {
  id         Int      @id @default(autoincrement())
  name       String
  lat        Float
  lon        Float
  street     String
  city       String
  province   String
  postalCode String
  isPrimary  Boolean
  createdAt  DateTime @default(now())
  updateAt   DateTime @updatedAt

  userId Int

  user Users @relation(fields: [userId], references: [id])

  @@map("address")
}

model Cart {
  id       Int @id @default(autoincrement())
  quantity Int

  productId Int
  variantId Int
  userId    Int

  user    Users   @relation(fields: [userId], references: [id])
  product Product @relation(fields: [productId], references: [id])
  variant Variant @relation(fields: [variantId], references: [id])

  @@map("cart")
}

enum OrderStatus {
  WAIT_USER
  CONFIRMATION_PAYMENT
  ON_PROGRESS
  ON_SHIPPING
  DONE
  CANCEL
}

model Order {
  id             Int         @id @default(autoincrement())
  status         OrderStatus
  total          Int
  shippingCost   Int
  shippingDetail Int
  discount       Int
  createdAt      DateTime    @default(now())
  updateAt       DateTime

  userId      Int
  warehouseId Int

  orderItems OrderItems[]
  payments   Payments?

  user      Users     @relation(fields: [userId], references: [id])
  warehouse Warehouse @relation(fields: [warehouseId], references: [id])

  @@map("order")
}

model OrderItems {
  id        Int @id @default(autoincrement())
  orderId   Int
  productId Int
  variantId Int

  order   Order   @relation(fields: [orderId], references: [id])
  product Product @relation(fields: [productId], references: [id])
  variant Variant @relation(fields: [variantId], references: [id])

  @@map("order_items")
}

enum PaymentsMethodType {
  MANUAL
  MIDTRANS
}

model Payments {
  id              Int                @id @default(autoincrement())
  invoiceNumber   String             @unique
  paymentMethod   PaymentsMethodType
  snapToken       String?
  snapRedirectUrl String?
  paymentProof    String?
  createdAt       DateTime           @default(now())
  updateAt        DateTime           @updatedAt

  orderId Int @unique

  order Order @relation(fields: [orderId], references: [id])

  @@map("payments")
}

model Employee {
  id        Int      @id @default(autoincrement())
  nik       String
  ktp       String
  npwp      String?
  salary    Int
  createdAt DateTime @default(now())
  updateAt  DateTime @updatedAt

  userId      Int @unique
  warehouseId Int

  user      Users?    @relation(fields: [userId], references: [id])
  warehouse Warehouse @relation(fields: [warehouseId], references: [id])

  @@map("employee")
}

model Warehouse {
  id       Int    @id @default(autoincrement())
  name     String
  street   String
  city     String
  province String
  state    String
  lat      Float
  lon      Float

  employee                    Employee[]
  order                       Order[]
  variantStocks               VariantStocks[]
  toWarehouseStockMutations   StockMutations[] @relation("toWarehouseStockMutations")
  fromWarehouseStockMutations StockMutations[] @relation("fromWarehouseStockMutations")

  @@map("warehouse")
}

model Category {
  id   Int    @id @default(autoincrement())
  name String @unique

  productCategory ProductCategory[]

  @@map("category")
}

model ProductCategory {
  id         Int @id @default(autoincrement())
  productId  Int
  CategoryId Int

  product  Product  @relation(fields: [productId], references: [id])
  category Category @relation(fields: [CategoryId], references: [id])

  @@map("product_category")
}

model ProductImages {
  id        Int      @id @default(autoincrement())
  url       String
  createdAt DateTime @default(now())
  updateAt  DateTime @updatedAt

  productId Int

  product Product @relation(fields: [productId], references: [id])

  @@map("product_images")
}

model Product {
  id          Int      @id @default(autoincrement())
  name        String
  description String
  createdAt   DateTime @default(now())
  updateAt    DateTime @updatedAt

  productImages   ProductImages[]
  productCategory ProductCategory[]
  variant         Variant[]
  cart            Cart[]
  stockMutations  StockMutations[]
  orderItems      OrderItems[]

  @@map("product")
}

model Variant {
  id        Int    @id @default(autoincrement())
  color     String
  size      String
  productId Int

  cart           Cart[]
  variantStocks  VariantStocks[]
  stockMutations StockMutations[]

  product    Product      @relation(fields: [productId], references: [id])
  orderItems OrderItems[]

  @@map("variant")
}

model VariantStocks {
  id       Int @id @default(autoincrement())
  quantity Int

  warehouseId Int
  variantId   Int

  warehouse Warehouse @relation(fields: [warehouseId], references: [id])
  variant   Variant   @relation(fields: [variantId], references: [id])

  @@map("variant_stocks")
}

enum StockMutationsStatus {
  WAIT_CONFIRMATION
  ON_PROGRESS
  DONE
}

enum StockMutationsType {
  IMPORT
  EXPORT
}

model StockMutations {
  id        Int                  @id @default(autoincrement())
  quantity  Int
  status    StockMutationsStatus
  type      StockMutationsType
  createdAt DateTime             @default(now())
  updateAt  DateTime             @updatedAt

  productId       Int
  variantId       Int
  fromWarehouseId Int?
  toWarehouseId   Int

  product       Product    @relation(fields: [productId], references: [id])
  variant       Variant    @relation(fields: [variantId], references: [id])
  fromWarehouse Warehouse? @relation("fromWarehouseStockMutations", fields: [fromWarehouseId], references: [id])
  toWarehouse   Warehouse  @relation("toWarehouseStockMutations", fields: [toWarehouseId], references: [id])

  @@map("stock_mutations")
}
